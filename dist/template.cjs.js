"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var t=function(t){return"\x3c!--"+t+"--\x3e"},e=function(t){return t.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")},r=/\s(\S+)\=[\"\']([^\"]*)$/,n=/^([^\"]*)[\"|\'][\s|\>]/,i=function(t){var e=t.nodeType,r=t.nodeValue;return e===Node.COMMENT_NODE&&parseInt(r)?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_REJECT},o=function(){function t(t,e){this.template=t,this.container=e}return t.prototype.getSlotByIndex=function(t){for(var e=this.template.slots.length,r=0;r<e;r++){var n=this.template.slots[r];if(n.slotIndex===t)return n}throw new Error("slot not found")},t.prototype.render=function(){var t=document.createNodeIterator(this.container,NodeFilter.SHOW_COMMENT,{acceptNode:i}),e=t.nextNode();if(null!==e)for(var r=0;e;){var n=parseInt(e.nodeValue);if(n>r)this.getSlotByIndex(n).commit(e),r=n;e=t.nextNode()}else this.container.appendChild(this.template.element)},t}(),s=function(){function t(t,e,r){this.slotIndex=t,this.attr=r,this.value=e}return Object.defineProperty(t.prototype,"isAttr",{get:function(){return null!==this.attr&&void 0!==this.attr},enumerable:!1,configurable:!0}),t.prototype.commit=function(t){if(this.isAttr)this.commitAttr(t.nextSibling);else{var e=this.value;if(Array.isArray(e)){for(var r=[],n=t.nextSibling;n.nodeType!==Node.COMMENT_NODE&&"-"!==n.nodeValue;)r.push(n),n=n.nextSibling;this.commitTemplates(r,t,n,e)}else{var i=t.nextSibling;"Template"===e.constructor.name?this.commitTemplate(i,t,e):this.commitValue(i,t,e)}}},t.prototype.commitAttr=function(t){var e=this.attr,r=Array.isArray(this.value)?this.value.join(" "):this.value;t.getAttribute(e)!==r&&t.setAttribute(e,r)},t.prototype.commitValue=function(t,e,r){null==t?e.parentNode.insertBefore(document.createTextNode(r),e.nextSibling):t.nodeValue!==r&&(t.nodeValue=r)},t.prototype.commitTemplate=function(t,e,r){void 0===t?e.parentNode.insertBefore(r.element,e.nextSibling):t.nodeType===Node.COMMENT_NODE?t.parentNode.insertBefore(r.element,t):r.match(t)?new o(r,t).render():t.parentNode.replaceChild(r.element,t)},t.prototype.commitTemplates=function(t,e,r,n){for(var i=n.length,o=t.length,s=i>o?i:o,a=0;a<s;a++){var l=[t[a],n[a]],u=l[0],c=l[1];if(void 0!==c){if("Template"!==c.constructor.name){throw new Error("to render a template into a list, every list items must be a Template instance.")}this.commitTemplate(u||r,e,c)}else void 0!==u&&u.parentNode.removeChild(u)}},t}(),a=function(){function i(t,e){void 0===e&&(e=[]),this.strings=t,this.slots=[],this.prepare(e)}return Object.defineProperty(i.prototype,"html",{get:function(){for(var e="",r=this.strings.length-1,n=0;n<r;n++){var i=this.slots[n];i.attr;var o=i.value;Array.isArray(o)&&(o=o.join("")),e+=this.strings[n]+o,this.slots[n].isAttr||(e+=t("-"))}return e+this.strings[r]},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"regexp",{get:function(){for(var r="",n=this.strings.length-1,i=0;i<n;i++)r+=e(this.strings[i])+"(.*)",this.slots[i].isAttr||(r+=e(t("-")));return r+=e(this.strings[n]),new RegExp(r)},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"element",{get:function(){return document.createRange().createContextualFragment(this.html)},enumerable:!1,configurable:!0}),i.prototype.toString=function(){return this.html},i.prototype.match=function(t){var e=t.outerHTML;return this.regexp.test(e)},i.prototype.prepare=function(e){for(var i=0,o=this.strings.length-1,a=0;a<o;a++){var l=this.strings[a],u=e[a];if("function"==typeof u){var c=u.name;if(""===c){throw new Error('injected functions cannot be inlined.Please define the function outside and reference it by its name. Ex.: <button onclick="${fn}">')}u=c+"()"}var h=r.exec(l);if(null!==h){var p=l.lastIndexOf("<");if(-1!=p&&i++,0===p)this.strings[a]=t(i)+l;else if(p>0){var f=l.substring(0,p-1),m=l.substring(p);this.strings[a]=f+t(i)+m}var d=h[1],g=h[2],v=this.strings[a].length-g.length;this.strings[a]=this.strings[a].slice(0,v);for(var y="",x=this.strings[a+1],b=n.exec(x);null===b;)y+=x+e[a+1],this.strings.splice(a+1,1),e.splice(a+1,1),o--,x=this.strings[a+1],b=n.exec(x);var N=b[1];this.strings[a+1]=x.slice(N.length);var T=g+u+y+N;this.slots.push(new s(i,T,d))}else i++,this.strings[a]=l+t(i),this.slots.push(new s(i,u))}},i}();exports.Template=a,exports.html=function(t){for(var e=[],r=1;r<arguments.length;r++)e[r-1]=arguments[r];return new a(t.raw.slice(0),e)},exports.render=function(t,e){return new o(t,e).render()};
