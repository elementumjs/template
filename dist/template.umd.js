!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e((t="undefined"!=typeof globalThis?globalThis:t||self).Template={})}(this,(function(t){"use strict";var e=function(t){return"\x3c!--"+t+"--\x3e"},n=function(t){return t.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")},r=/\s(\S+)\=[\"\']([^\"]*)$/,i=/^([^\"]*)[\"|\'][\s|\>]/,o=function(t){var e=t.nodeType,n=t.nodeValue;return e===Node.COMMENT_NODE&&parseInt(n)?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_REJECT},s=function(){function t(t,e){this.template=t,this.container=e}return t.prototype.getSlotByIndex=function(t){for(var e=this.template.slots.length,n=0;n<e;n++){var r=this.template.slots[n];if(r.slotIndex===t)return r}throw new Error("slot not found")},t.prototype.render=function(){var t=document.createNodeIterator(this.container,NodeFilter.SHOW_COMMENT,{acceptNode:o}),e=t.nextNode();if(null!==e)for(var n=0;e;){var r=parseInt(e.nodeValue);if(r>n)this.getSlotByIndex(r).commit(e),n=r;e=t.nextNode()}else this.container.appendChild(this.template.element)},t}(),a=function(){function t(t,e,n){this.slotIndex=t,this.attr=n,this.value=e}return Object.defineProperty(t.prototype,"isAttr",{get:function(){return null!==this.attr&&void 0!==this.attr},enumerable:!1,configurable:!0}),t.prototype.commit=function(t){if(this.isAttr)this.commitAttr(t.nextSibling);else{var e=this.value;if(Array.isArray(e)){for(var n=[],r=t.nextSibling;r.nodeType!==Node.COMMENT_NODE&&"-"!==r.nodeValue;)n.push(r),r=r.nextSibling;this.commitTemplates(n,t,r,e)}else{var i=t.nextSibling;"Template"===e.constructor.name?this.commitTemplate(i,t,e):this.commitValue(i,t,e)}}},t.prototype.commitAttr=function(t){var e=this.attr,n=Array.isArray(this.value)?this.value.join(" "):this.value;t.getAttribute(e)!==n&&t.setAttribute(e,n)},t.prototype.commitValue=function(t,e,n){null==t?e.parentNode.insertBefore(document.createTextNode(n),e.nextSibling):t.nodeValue!==n&&(t.nodeValue=n)},t.prototype.commitTemplate=function(t,e,n){void 0===t?e.parentNode.insertBefore(n.element,e.nextSibling):t.nodeType===Node.COMMENT_NODE?t.parentNode.insertBefore(n.element,t):n.match(t)?new s(n,t).render():t.parentNode.replaceChild(n.element,t)},t.prototype.commitTemplates=function(t,e,n,r){for(var i=r.length,o=t.length,s=i>o?i:o,a=0;a<s;a++){var l=[t[a],r[a]],u=l[0],c=l[1];if(void 0!==c){if("Template"!==c.constructor.name){throw new Error("to render a template into a list, every list items must be a Template instance.")}this.commitTemplate(u||n,e,c)}else void 0!==u&&u.parentNode.removeChild(u)}},t}(),l=function(){function t(t,e){void 0===e&&(e=[]),this.strings=t,this.slots=[],this.prepare(e)}return Object.defineProperty(t.prototype,"html",{get:function(){for(var t="",n=this.strings.length-1,r=0;r<n;r++){var i=this.slots[r];i.attr;var o=i.value;Array.isArray(o)&&(o=o.join("")),t+=this.strings[r]+o,this.slots[r].isAttr||(t+=e("-"))}return t+this.strings[n]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"regexp",{get:function(){for(var t="",r=this.strings.length-1,i=0;i<r;i++)t+=n(this.strings[i])+"(.*)",this.slots[i].isAttr||(t+=n(e("-")));return t+=n(this.strings[r]),new RegExp(t)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"element",{get:function(){return document.createRange().createContextualFragment(this.html)},enumerable:!1,configurable:!0}),t.prototype.toString=function(){return this.html},t.prototype.match=function(t){var e=t.outerHTML;return this.regexp.test(e)},t.prototype.prepare=function(t){for(var n=0,o=this.strings.length-1,s=0;s<o;s++){var l=this.strings[s],u=t[s];if("function"==typeof u){var c=u.name;if(""===c){throw new Error('injected functions cannot be inlined.Please define the function outside and reference it by its name. Ex.: <button onclick="${fn}">')}u=c+"()"}var p=r.exec(l);if(null!==p){var h=l.lastIndexOf("<");if(-1!=h&&n++,0===h)this.strings[s]=e(n)+l;else if(h>0){var f=l.substring(0,h-1),d=l.substring(h);this.strings[s]=f+e(n)+d}var m=p[1],g=p[2],v=this.strings[s].length-g.length;this.strings[s]=this.strings[s].slice(0,v);for(var y="",b=this.strings[s+1],x=i.exec(b);null===x;)y+=b+t[s+1],this.strings.splice(s+1,1),t.splice(s+1,1),o--,b=this.strings[s+1],x=i.exec(b);var T=x[1];this.strings[s+1]=b.slice(T.length);var N=g+u+y+T;this.slots.push(new a(n,N,m))}else n++,this.strings[s]=l+e(n),this.slots.push(new a(n,u))}},t}();t.Template=l,t.html=function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];return new l(t.raw.slice(0),e)},t.render=function(t,e){return new s(t,e).render()},Object.defineProperty(t,"__esModule",{value:!0})}));
